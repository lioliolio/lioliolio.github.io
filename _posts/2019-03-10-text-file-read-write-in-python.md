---
layout: post
title: "파이썬으로 텍스트 파일을 읽고 쓸 때 주의할 점"
date: 2019-02-10
---
텍스트 파일을 다루면서 실수했던 것들을 정리해보았습니다.

### 1. encoding
모든 OS의 기본 인코딩이 똑같다면 신경쓰지 않아도 되는 문제입니다. 하지만 현실에서는 OS마다 기본 인코딩이 다릅니다. 따라서 호환성 문제를 일으키지 않기 위해서는 항상 인코딩을 지정하는 것이 좋습니다.

그렇지 않다면 다음 예제와 같은 상황을 겪을 수 있습니다.

```
# 전문가를 위한 파이썬 예제
# 기본 인코딩이 CP-1252 인 경우
open('cafe.txt', 'w', encoding='utf_8').write('Café')
open('cafe.txt').read()
-----------------------
'Cafأ©'
``` 

파일을 쓸 때는 `UTF-8`을 지정했지만 파일을 읽을 때는 인코딩을 지정하지 않았습니다. **Unix/Linux**  처럼 기본 인코딩이 `UTF-8`이라면 문제가 없겠지만 위의 예제처럼 기본 인코딩이 `CP-1252`나 다른 인코딩 방식을 사용하는 경우 디코딩시 원하는 결과를 얻지 못할 수 있습니다. 

### 2. close()
파일을 `open()` 함수를 연 경우에는 `close()` 함수를 사용하여 명시적으로 파일을 닫는 것이 좋습니다. 파일의 크기가 작다면 큰 문제가 없지만 데이터가 큰 파일을 다루는 경우, `close()` 함수를 사용하여 닫지 않는다면 파일의 참조 객체가 다른 파일에 재할당 되기 전까지 메모리에 계속 있게 됩니다.

```
# close() 함수 사용
fp = open('cafe.txt', encoding='utf_8').read()
fp.close()
```

다른 방법으로는 `with` 문이 있습니다. `with`문을 사용하면 명시적으로 `close()` 함수를 사용하지 않더라도 `with` 문이 끝날 때 자동으로 파일을 닫습니다.

```
# with 문 사용
with open('cafe.txt', encoding='utf_8') as fp:
    fp.read()
```

`with`문은 단순히 파일을 열고 닫는 용도로만 쓰이진 않습니다. 다음에 `with`문 관련해서 정리를 하도록 하겠습니다.    

### 3. 파일 경로
파일 경로의 경우 **절대 경로**와 **상대 경로**를 사용할 수 있습니다. **상대 경로**는 **현재 작업 디렉토리**를 기준으로 합니다. 

**Jupyter Notebook**과 같은 대화형 쉘의 경우 현재 파일 또는 현재 위치를 기준으로 합니다. `os.getcwd()` 함수를 사용하여 현재 경로를 알 수 있습니다.

파이썬 스크립트 파일에서도 똑같이 상대경로를 사용할 수는 있지만 어느 위치에서 파이썬 스크립트를 실행하느냐에 따라 실행이 안될 수 있습니다. 따라서 다음과 같이 `__file__`을 사용하여 경로를 지정할 수 있습니다.

```
# 텍스트 파일이 같은 폴더에 있는 경우
import os
file_path = os.path.join(os.path.dirname(__file__), 'cafe.txt')
open(file_path, encoding='utf_8').read()
...
```

### 참고
- 전문가를 위한 파이썬
- [python open](https://docs.python.org/3/library/functions.html?highlight=open#open)